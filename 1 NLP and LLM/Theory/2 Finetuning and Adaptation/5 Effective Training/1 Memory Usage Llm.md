# –ö—É–¥–∞ —É—Ö–æ–¥–∏—Ç –ø–∞–º—è—Ç—å –≤ LLM

–†–∞–∑–±–µ—Ä—ë–º—Å—è, –∫–∞–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–¥–µ–ª–∏ –∑–∞–Ω–∏–º–∞—é—Ç –ø–∞–º—è—Ç—å –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ.

## –¢–∏–ø—ã —á–∏—Å–µ–ª –∏ –∏—Ö –≤–ª–∏—è–Ω–∏–µ

–ú–æ–¥–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:

* **FP32 (float32)** ‚Äî 4 –±–∞–π—Ç–∞ –Ω–∞ —á–∏—Å–ª–æ, –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å.
* **FP16 (float16)** ‚Äî 2 –±–∞–π—Ç–∞, –º–µ–Ω—å—à–µ —Ç–æ—á–Ω–æ—Å—Ç—å.
* **BF16 (bfloat16)** ‚Äî —Ç–∞–∫–∂–µ 2 –±–∞–π—Ç–∞, –Ω–æ —à–∏—Ä–µ –¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π, —á–µ–º —É FP16.

> üí° –û–±—ã—á–Ω–æ LLM –æ–±—É—á–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ **BF16**, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã—Ö –≤–∑—Ä—ã–≤–æ–≤ –∏ –∑–∞—Ç—É—Ö–∞–Ω–∏—è –∑–∞ —Å—á—ë—Ç –±–æ–ª—å—à–µ–≥–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞.

## –†–∞—Å—á—ë—Ç –ø–∞–º—è—Ç–∏ –ø–æ–¥ –º–æ–¥–µ–ª—å

–ü—É—Å—Ç—å –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç $N$ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –¢–æ–≥–¥–∞:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                     | FP32 (–±–∞–π—Ç)   | F16/BF16 (–±–∞–π—Ç)                                               |
| ----------------------------- | ------------- | ------------------------------------------------------------- |
| –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏              | $4\cdot N$  | $2\cdot N$ (–≤–µ—Å) + $4\cdot N$ (fp32-–∫–æ–ø–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è) |
| –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã                     | $4\cdot N$  | $4\cdot N$ (–≤ fp32 –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)                        |
| –°–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞ (Adam) | $8\cdot N$  | $8\cdot N$ (m –∏ v –≤ fp32)                                   |
| **–ò—Ç–æ–≥–æ (–±–µ–∑ –∞–∫—Ç–∏–≤–∞—Ü–∏–π)**     | $16\cdot N$ | $18\cdot N$                                                 |

## –ê–∫—Ç–∏–≤–∞—Ü–∏–∏

–ê–∫—Ç–∏–≤–∞—Ü–∏–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–µ–Ω–∑–æ—Ä—ã, –≤–æ–∑–Ω–∏–∫–∞—é—â–∏–µ –ø—Ä–∏ –ø—Ä–æ—Ö–æ–¥–µ –≤–ø–µ—Ä—ë–¥ (forward). –ò—Ö –≤–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

* **–ù–∞ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ** –º–æ–∂–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è beam search).
* **–ù–∞ –æ–±—É—á–µ–Ω–∏–∏** –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è backward ‚Äî —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–æ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞.
* **–ß–µ–∫–ø–æ–π–Ω—Ç–∏–Ω–≥ –∞–∫—Ç–∏–≤–∞—Ü–∏–π** (activation checkpointing) –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ –ø–∞–º—è—Ç–∏, –∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥ –ø–∞–º—è—Ç–∏, –Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è.
* –ê–∫—Ç–∏–≤–∞—Ü–∏–∏ —á–∞—Å—Ç–æ –∑–∞–Ω–∏–º–∞—é—Ç **–±–æ–ª—å—à–µ** –º–µ—Å—Ç–∞, —á–µ–º —Å–∞–º–∞ –º–æ–¥–µ–ª—å, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è—Ö.

### –ü—Ä–∏–º–µ—Ä—ã

* –ú–æ–¥–µ–ª—å **1.5B –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**, $\text{seq\_len} = 1024$, $\text{batch\_size} = 32$:

  * –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π ‚Äî –¥–æ **60 GB** –ø–∞–º—è—Ç–∏.
  * –° —á–µ–∫–ø–æ–π–Ω—Ç–∏–Ω–≥–æ–º ‚Äî **\~8 GB** –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.

* –ú–æ–¥–µ–ª—å **100B –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**:

  * –î–∞–∂–µ —Å —á–µ–∫–ø–æ–π–Ω—Ç–∏–Ω–≥–æ–º ‚Äî **60+ GB** —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.

## –í—Ç–æ—Ä–∏—á–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:

* **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É—Ñ–µ—Ä—ã**: –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ attention, matmul).
* **–§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞–º—è—Ç–∏**: –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–ª–ª–æ–∫–∞—Ü–∏–π/–¥–µ–∞–ª–ª–æ–∫–∞—Ü–∏–π —Å–æ–∑–¥–∞—é—Ç ¬´–¥—ã—Ä—ã¬ª, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
* **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö** –≤–ª–∏—è—é—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–∞–º—è—Ç—å, –Ω–æ –∏ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å: F16/BF16 –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ TPU/GPU.

## –í—ã–≤–æ–¥—ã

* –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã ‚Äî —ç—Ç–æ **–≤–µ—Å–∞, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã, —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏**.
* FP16/BF16 —ç–∫–æ–Ω–æ–º—è—Ç –ø–∞–º—è—Ç—å, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ mixed precision.
* **–ß–µ–∫–ø–æ–π–Ω—Ç–∏–Ω–≥** ‚Äî –∫—Ä–∏—Ç–∏—á–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –±–æ–ª—å—à–∏—Ö –º–æ–¥–µ–ª–µ–π.
* **Memory profiling** –∏ –≥—Ä–∞–º–æ—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±—É—Ñ–µ—Ä–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—É—Ä–æ–≤–Ω—è.
