# Prompt Tuning

## 1. –ú–æ—Ç–∏–≤–∞—Ü–∏—è

**Prompt Tuning** ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä–æ-—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º—É fine-tuning. –í–º–µ—Å—Ç–æ –¥–æ–æ–±—É—á–µ–Ω–∏—è –≤—Å–µ–π –º–æ–¥–µ–ª–∏, –º—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ embedding-–ø–æ–¥—Å–∫–∞–∑–∫–∏ (prompt tokens), –¥–æ–±–∞–≤–ª—è–µ–º—ã–µ –∫ –≤—Ö–æ–¥—É –º–æ–¥–µ–ª–∏. –û—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –±–æ–ª—å—à–∏—Ö LLM, –≥–¥–µ –ø–æ–ª–Ω—ã–π fine-tuning —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º.

### –ü—Ä–æ–±–ª–µ–º–∞
- –ü–æ–ª–Ω—ã–π fine-tuning —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏ (–º–∏–ª–ª–∏–∞—Ä–¥—ã),
- –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –ø–∞–º—è—Ç—å, —Å–ª–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏,
- –ù—É–∂–Ω–æ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ.

### –†–µ—à–µ–Ω–∏–µ
- –ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ–º –º–æ–¥–µ–ª—å,
- –î–æ–±–∞–≤–ª—è–µ–º –æ–±—É—á–∞–µ–º—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ $P \in \mathbb{R}^{m \times d}$ –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é,
- –¢–æ–ª—å–∫–æ –æ–Ω–∏ –∏ –æ–±—É—á–∞—é—Ç—Å—è.

---

## 2. –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞

–ü—É—Å—Ç—å:
- $x$ ‚Äî –∏—Å—Ö–æ–¥–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ (–≤ –≤–∏–¥–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤),
- $f(\cdot)$ ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä,
- $P \in \mathbb{R}^{m \times d}$ ‚Äî –æ–±—É—á–∞–µ–º—ã–π prompt (embedding-–º–∞—Ç—Ä–∏—Ü–∞),
- $\hat{y}$ ‚Äî –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏,

–¢–æ–≥–¥–∞:
$$
\hat{y} = f([P; x])
$$
–ì–¥–µ $[P; x]$ ‚Äî –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è prompt-—Ç–æ–∫–µ–Ω–æ–≤ –∏ –≤—Ö–æ–¥–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º —Å–ª–æ–µ–º –º–æ–¥–µ–ª–∏.

–ü–æ—Ç–µ—Ä–∏:
$$
\mathcal{L}(\hat{y}, y) \to \text{—Ç–æ–ª—å–∫–æ } P \text{ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è}
$$

---

## 3. –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞                  | Prompt Tuning                            |
|--------------------------------|------------------------------------------|
| üî∫ –ü–ª—é—Å—ã                        |                                          |
| –≠–∫–æ–Ω–æ–º–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤            | –¢–æ–ª—å–∫–æ prompt (—Ç—ã—Å—è—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)        |
| –£–¥–æ–±—Å—Ç–≤–æ –¥–µ–ø–ª–æ—è                | –ú–æ–¥–µ–ª—å –Ω–µ–∏–∑–º–µ–Ω–Ω–∞, –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º–∞—è   |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏—Ç–∞—Å–∫–∏–Ω–≥–∞       | –û—Ç–¥–µ–ª—å–Ω—ã–µ soft prompts –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ |
| üîª –ú–∏–Ω—É—Å—ã                       |                                          |
| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —ç–∫—Å–ø—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å   | –û—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö reasoning-–∑–∞–¥–∞—á–∞—Ö    |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —á–∏—Å–ª–∞ —Ç–æ–∫–µ–Ω–æ–≤   | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–ª–∏–Ω–∞ prompt –≤–∞–∂–Ω—ã       |
| –ú–æ–∂–µ—Ç –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å –ø–æ –∫–∞—á–µ—Å—Ç–≤—É  | Full-tuning –¥–∞—ë—Ç –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ         |

---

## 4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

| –ú–µ—Ç–æ–¥                  | –ß—Ç–æ –æ–±—É—á–∞–µ—Ç—Å—è            | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏ | –ö–∞—á–µ—Å—Ç–≤–æ | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |
|------------------------|--------------------------|----------------------|----------|----------------|
| Full fine-tuning       | –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã            | –í—ã—Å–æ–∫–∞—è           | –í—ã—Å–æ–∫–æ–µ | –Ω–µ—Ç             |
| LoRA / QLoRA           | Low-rank –∞–¥–∞–ø—Ç–µ—Ä—ã        | –°—Ä–µ–¥–Ω—è—è           | –í—ã—Å–æ–∫–æ–µ | –¥–∞             |
| Prompt Tuning          | –¢–æ–ª—å–∫–æ soft prompts      | –ù–∏–∑–∫–∞—è            | –°—Ä–µ–¥–Ω–µ–µ | –¥–∞             |
| Prefix / P-Tuning      | –ü—Ä–æ–º–ø—Ç + –ø–æ–∑–∏—Ü–∏–∏         | –ù–∏–∑–∫–∞—è            | –°—Ä–µ–¥–Ω–µ–µ | –¥–∞             |
| Adapters               | –ú–∞–ª—ã–µ –±–ª–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ—ë–≤ | –°—Ä–µ–¥–Ω—è—è           | –í—ã—Å–æ–∫–æ–µ | –¥–∞             |

---

## 5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å `peft` (HuggingFace)

```python
from peft import PromptTuningConfig, get_peft_model, TaskType
from transformers import AutoModelForCausalLM, AutoTokenizer

model = AutoModelForCausalLM.from_pretrained("EleutherAI/gpt-neo-1.3B")
tokenizer = AutoTokenizer.from_pretrained("EleutherAI/gpt-neo-1.3B")

config = PromptTuningConfig(
    task_type=TaskType.CAUSAL_LM,
    num_virtual_tokens=20,
    tokenizer_name_or_path="EleutherAI/gpt-neo-1.3B"
)

peft_model = get_peft_model(model, config)
peft_model.print_trainable_parameters()
```

–î–∞–ª–µ–µ ‚Äî –æ–±—ã—á–Ω—ã–π `Trainer` –∏–ª–∏ `accelerate`.

---

## 6. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –ü—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö,
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –º–Ω–æ–∂–µ—Å—Ç–≤—É –∑–∞–¥–∞—á (multi-task),
- –ö–æ–≥–¥–∞ –Ω–µ–ª—å–∑—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –º–æ–¥–µ–ª—å (compliance / —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è),
- –î–ª—è edge-–¥–µ–ø–ª–æ—è –∏–ª–∏ inference —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ä–∞–∑–Ω—ã—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–π (—á–µ—Ä–µ–∑ soft prompt bank),
- –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏ –ø–æ–¥ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ –±–µ–∑ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è –≤—Å–µ–π –º–æ–¥–µ–ª–∏.
- –ö–æ–≥–¥–∞ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ black-box API

---

## 7. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

- **Prefix Tuning** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –∞ –≤–µ–∫—Ç–æ—Ä—ã –∫ –∫–∞–∂–¥–æ–º—É —Å–ª–æ—é attention.
- **P-Tuning v2** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç learnable –ø—Ä–æ–º–ø—Ç –∫ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ hidden-state —á–µ—Ä–µ–∑ LSTM.
- **Prompt + LoRA** ‚Äî –∏–Ω–æ–≥–¥–∞ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç—Å—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
Prompt Tuning ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ LLM, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —ç–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–∏. –≠—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∏ –±—ã—Å—Ç—Ä—ã—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π. –û–¥–Ω–∞–∫–æ –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö —Å –≤—ã—Å–æ–∫–æ–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥–∞–º –≤—Ä–æ–¥–µ full-tuning –∏–ª–∏ LoRA.

