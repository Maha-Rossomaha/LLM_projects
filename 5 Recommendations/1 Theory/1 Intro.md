# RecSys Intro

## 1. Что такое рекомендательная система в продукте

Рекомендательная система — это **механизм распределения внимания пользователя**, встроенный в продуктовую воронку. Она не существует сама по себе и не оптимизирует «качество рекомендаций» в абстракции — она оптимизирует **бизнес-метрику** при заданных ограничениях.

Типовые места в продукте:

* главная лента / витрина
* блоки «вам может понравиться», «похожие», «часто покупают вместе»
* персональные подборки, пуши, письма

Важно: рекомендация — это **решение в условиях ограниченного внимания**, а не задача классификации или регрессии.

## 2. Цель рекомендательной системы

> максимизировать целевую продуктовую метрику при соблюдении бизнес- и этических ограничений

Расхожая формулировка «показать новое и актуальное» — неполная и вводящая в заблуждение:

* «новизна» и «актуальность» сами по себе не цель,
* это либо регуляризаторы, либо дополнительные ограничения,
* либо отдельные вспомогательные метрики.

Если система стабильно увеличивает метрику, но делает это за счёт деградации пользовательского опыта (однообразие, кликбейт, токсичный контент, нерелевантные дорогие товары), значит цель поставлена неправильно.

## 3. Основные типы рекомендаций (на уровне смысла)

### Collaborative filtering (CF)

Опирается на **историю взаимодействий пользователей с объектами**.

Идея: пользователи с похожим поведением будут предпочитать похожие объекты.

Сильные стороны:

* хорошо улавливает коллективные паттерны вкуса,
* не требует явного описания контента.

Слабые стороны:

* холодный старт пользователей и объектов,
* сильная зависимость от плотности данных.

### Content-based

Опирается на **признаки объектов и/или пользователей**:
жанры, категории, текст, эмбеддинги, атрибуты.

Сильные стороны:

* решает cold start объектов,
* легко контролируется правилами.

Слабые стороны:

* склонность к «пузырю фильтров» - когда рекомендательная система показывает пользователю всё более узкий и однотипный контент, потому что обучается на его прошлых кликах и тем самым усиливает сама себя.,
* хуже ловит неочевидные паттерны предпочтений.

### Hybrid

Практически любой production‑рекоммендер — гибрид.

Гибридность бывает:

* на уровне кандидатов (несколько источников кандидатов),
* на уровне признаков (CF‑сигналы + контент + правила),
* на уровне пайплайна (разные модели на разных этапах).

## 4. Какие данные реально доступны рекомендательной системе

### Explicit feedback

Явные оценки:

* рейтинги,
* лайки/дизлайки,
* отзывы.

Плюсы:

* сигнал более «чистый».

Минусы:

* редкий,
* часто смещён (оценивают не все).

### Implicit feedback

Неявные сигналы:

* клики,
* просмотры,
* время просмотра,
* скроллы,
* покупки.

Ключевой момент:

> отсутствие взаимодействия **не означает негативную обратную связь**.

Причины:

* объект могли не показать,
* объект был показан в плохой позиции,
* пользователь не дошёл до него физически.

## 5. Экспозиция и position bias

Для корректного обучения и оценки важно различать:

* **объект был показан**,
* **объект был доступен пользователю**,
* **пользователь взаимодействовал**.

Если система не логирует факты показа и позицию:

* обучение получает искажённый сигнал,
* оффлайн‑метрики становятся недостоверными,
* возникает переоценка популярных объектов.

Это фундаментальная проблема, а не техническая мелочь.

## 6. Минимальная схема логов

Без этого честный рекоммендер невозможен:

* `user_id`
* `item_id`
* `timestamp`
* `event_type` (impression / click / view / purchase и т.д.)
* `position` в выдаче
* `session_id`
* `context` (устройство, гео, источник трафика)
* `algorithm_version`

Отсутствие логов экспозиции — красный флаг качества данных.

## 7. Базовые проблемы данных

### Cold start

* **пользователь**: нет истории → нечего персонализировать
* **объект**: нет взаимодействий → CF его не покажет

Решения:

* популярное,
* контентные признаки,
* онбординг,
* правила и квоты.

### Разреженность

Матрица user–item крайне разреженная.

Следствия:

* шумные оценки сходства,
* необходимость обобщающих моделей,
* важность регуляризации и агрегаций.

### Популярность и long tail

Небольшое число объектов получает большую часть взаимодействий.

Если это не учитывать:

* система вырождается в «топ‑популярное»,
* новые и нишевые объекты не получают экспозиции,
* качество деградирует в долгосрочной перспективе.