# Фичи и входные представления

## 1. Query-документ признаки

- **BM25** — классический лексический скоринг, учитывающий частоту терма в документе (TF), обратную частоту в корпусе (IDF) и нормализацию по длине документа. Важен для редких или ключевых слов запроса.
- **Cosine similarity** — косинусная близость между эмбеддингами запроса и документа; позволяет измерять семантическую схожесть поверх распределённых представлений.
- **Title match** — бинарный или числовой сигнал совпадения слов из запроса в заголовке документа; может учитывать точное совпадение, частичное совпадение, порядок слов.
- **Position** — порядковая позиция документа в исходном списке кандидатов (например, в топ‑1000 от dense‑retrieval/ANN); часто используется как сильный bias‑сигнал.
- **Freshness** — временной признак: возраст документа относительно момента запроса; может быть представлен как временной лаг или экспоненциальное затухание (temporal decay).
- **User CTR** — поведенческий сигнал: вероятность клика по документу данным пользователем или усреднённая по группе; может включать историю взаимодействий, сегментацию по типу пользователя.
- **Прочие сигналы** — длина документа, популярность, авторитетность источника, а также diversity/novelty признаки (например, насколько документ отличается от уже показанных).

## 2. Категориальные фичи

- **One-hot** кодирование: простое, но разреженное представление категорий.
- **Embeddings**: плотные векторы категориальных признаков (например, id документа, id пользователя, категория товара).
- **Feature hashing**: компромиссный вариант для высоко‑кардинальных категорий.

## 3. Нормализация признаков

- **Per-query normalization**: нормализация признаков в пределах одного запроса. Обычно берутся все кандидаты для конкретного запроса и значения признака приводятся к одному масштабу (например, min-max или z-score внутри списка кандидатов). Это гарантирует сопоставимость и уменьшает влияние масштаба признаков между разными запросами.
- **Global normalization**: нормализация по всему корпусу или датасету. Подходит для признаков, значения которых должны быть сравнимы между запросами (например, глобальный CTR, частота документа). Часто используется стандартное z-score или лог-преобразование.
- **Rank-based normalization**: вместо абсолютных значений признаков используется их относительный порядок внутри запроса. Признаки преобразуются в ранговые позиции (например, лучший документ = 1, худший = N). Это снижает чувствительность к масштабу признаков и может повысить устойчивость модели.

## 4. Query-relative свойства

- Все фичи должны быть **относительными к запросу**: оценивается не абсолютное значение признака, а его значимость в контексте текущего запроса.
- Пример: document length сам по себе неинформативен, но в сравнении между кандидатами в рамках одного запроса может влиять на релевантность.

---

**Итог:** входные представления для LTR и reranking строятся как комбинация текстовых, категориальных, временных и поведенческих сигналов, с обязательной нормализацией per-query. Это гарантирует корректность сравнения документов внутри одного запроса.