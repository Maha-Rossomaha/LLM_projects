# Monitoring and SLO

## 1. Зачем нужен мониторинг

Qdrant используется как компонент в продакшн-системах поиска и RAG. Чтобы гарантировать стабильность и SLA, важно наблюдать за ключевыми метриками производительности и надёжности.

---

## 2. Основные метрики

### Латентность

- **p50 / p95 / p99** — задержка обработки запросов на разных перцентилях.
- p95 и p99 показывают «хвостовую» задержку и влияют на пользовательский опыт.

### QPS (Queries Per Second)

- Сколько запросов обрабатывает кластер в секунду.
- Важно для оценки пропускной способности и автоскейлинга.

### Доля таймаутов

- Процент запросов, завершившихся по таймауту.
- Рост метрики = перегрузка кластера или проблемы с сетью/диском.

### RAM и дисковый IO

- **RAM** — потребление памяти сегментами и индексами.
- **Disk IO** — скорость чтения/записи данных.
- Важно контролировать при использовании `memmap_threshold` (часть сегментов может уходить в mmap).

### Частота оптимизаций

- Сколько операций оптимизации (слияния сегментов, перестроек индекса) выполняется.
- Рост частоты = перегруз ingestion или слишком агрессивные параметры оптимизатора.

### Аварийные сигналы

- Ошибки поиска или вставки.
- Повторные падения сегментов.
- Превышение лимитов памяти или диска.

---

## 3. Инструменты мониторинга

- **Prometheus + Grafana** — основной стек для метрик и дашбордов.
- **OpenTelemetry** — трассировка запросов end-to-end.
- **Логи** — для анализа ошибок и сбоев.

---

## 4. SLO (Service Level Objectives)

Примеры целевых значений:

- **Латентность p95**: < 100 мс для поисковых запросов при N=10M векторов.
- **QPS**: поддержка нагрузки до X запросов/сек без деградации качества.
- **Таймауты**: < 1% запросов завершается ошибкой или таймаутом.
- **RAM**: использование не превышает 80% доступной памяти.
- **Disk IO**: не более Y операций/сек для стабильной работы.
